@model List<Projet_Exam_ASP.NetCore.Models.Offre>
@inject LanguageService language
@using Projet_Exam_ASP.NetCore.Data.enums

@*<div id="filtres">
        <p>@ViewBag.categorie </p>
    </div>
    @using (Html.BeginForm("Index", "Filtre", FormMethod.Post))
    {
        <input type="button" value="Supprimer les filtres par catégorie" class="btn btn-primary" onClick="this.form.submit();removeCat(); ">
    }
    <div id="filtres">
        <p>@ViewBag.search</p>
    </div>
    @using (Html.BeginForm("Index", "Filtre", FormMethod.Post))
    {
        <input type="button" value="Supprimer les filtres par recherche" class="btn btn-primary" onClick="this.form.submit();removeSearch(); ">
    }*@

@*<table class="table">
        <thead>
            <tr>
                <th>

                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Titre)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Ville)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Date_Dépot)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Description)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Catégorie)
                </th>
                <th>
                    @Html.DisplayName("Sous Catégorie")
                </th>
                <th>
                    @Html.DisplayName(language.Getkey("Propriétaire"))
                </th>
                <th>
                    @if (User.IsInRole("Admin"))
                        @Html.DisplayNameFor(model => model.Valide)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.reduction)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @{ int i = 0; }
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @if (ViewBag.currentUser != null && ViewBag.currentUser.Id == item.AppUserId && ViewBag.All_Mine_Favoris != 1)
                        {
                            <h6>Votre offre</h6>
                        }
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Titre)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Ville)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Date_Dépot)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Description)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Catégorie)
                    </td>
                    <td>
                        @{String s;
                            List<String> sousCatList;
                            switch ((int)item.Catégorie)
                            {
                                case 0:
                                    sousCatList = Enum.GetNames(typeof(INFORMATIQUE_ET_MULTIMEDIA)).ToList();
                                    break;
                                case 1:
                                    sousCatList = Enum.GetNames(typeof(HABILLEMENT_ET_BIEN_ETRE)).ToList();
                                    break;
                                case 2:
                                    sousCatList = Enum.GetNames(typeof(VEHICULES)).ToList();
                                    break;
                                case 3:
                                    sousCatList = Enum.GetNames(typeof(LOISIRS_ET_DIVERTISSEMENT)).ToList();
                                    break;
                                case 4:
                                    sousCatList = Enum.GetNames(typeof(IMMOBILIER)).ToList();
                                    break;
                                default:
                                    sousCatList = Enum.GetNames(typeof(POUR_LA_MAISON_ET_JARDIN)).ToList();
                                    break;
                            }
                            s = sousCatList[item.IndiceSousCatégorie];
                        }
                        <p>@s</p>
                    </td>
                    <td>
                        @Html.DisplayFor(model => item.AppUser.Nom)
                    </td>
                    <td>
                        @if (User.IsInRole("Admin"))
                            @Html.DisplayFor(modelItem => item.Valide)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.reduction)
                    </td>
                    <td>
                </tr>
                i++;
            }
        </tbody>
    </table>

    <script>
        function removeCat() {
            $.get("/Filtre/removeCat");
        }
        function removeSearch() {
            $.get("/Filtre/removeSearch");
        }
    </script>*@




<style>


    #bd h2 {
        color: #000;
        font-size: 26px;
        font-weight: 300;
        text-align: center;
        text-transform: uppercase;
        position: relative;
        margin: 30px 0 80px;
    }

        #bd h2 b {
            color: #ffc000;
        }





    .img-box {
        height: 160px;
        width: 100%;
        position: relative;
    }

    img {
        max-width: 100%;
        max-height: 100%;
        display: inline-block;
        /*position: absolute;*/
        bottom: 0;
        margin: 0 auto;
        left: 0;
        right: 0;
    }

    #bd h4 {
        font-size: 18px;
        margin: 10px 0;
    }

    .btn {
        color: #333;
        border-radius: 0;
        font-size: 11px;
        text-transform: uppercase;
        font-weight: bold;
        background: none;
        border: 1px solid #ccc;
        padding: 5px 10px;
        margin-top: 5px;
        line-height: 16px;
    }

        .btn:hover {
            color: #fff;
            background: #000;
            border-color: #000;
            box-shadow: none;
        }

        .btn i {
            font-size: 14px;
            font-weight: bold;
            margin-left: 5px;
        }

    .thumb-wrapper {
        text-align: center;
        background: #dee2e640;
        width: 220px;
        margin: 20px;
    }

    .thumb-content {
        padding: 15px;
    }

    .item-price {
        font-size: 1.3em;
        padding: 2px 0;
    }

        .item-price strike {
            color: #999;
            margin-right: 5px;
        }

        .item-price span {
            color: #bd5757;
            font-size: 110%;
        }

    .fa-heart {
        color: #e03939;
    }

        .fa-heart:hover {
            color: #e0393985;
        }
</style>

<script>
    function FavoriChange(i) {
        var f = document.getElementById('offre' + i);
        f.style.display = 'none';
        $.get("/Offres/AddRemoveFavoris", { id: i });
    }
    function getVals() {
        // Get slider values
        var parent = this.parentNode;
        var slides = parent.getElementsByTagName("input");
        var slide1 = parseFloat(slides[0].value);
        var slide2 = parseFloat(slides[1].value);
        // Neither slider will clip the other, so make sure we determine which is larger
        if (slide1 > slide2) { var tmp = slide2; slide2 = slide1; slide1 = tmp; }

        var displayElement = parent.getElementsByClassName("rangeValues")[0];
        displayElement.innerHTML = "$ " + slide1 + "k - $" + slide2 + "k";
    }

    window.onload = function () {
        // Initialize Sliders
        var sliderSections = document.getElementsByClassName("range-slider");
        for (var x = 0; x < sliderSections.length; x++) {
            var sliders = sliderSections[x].getElementsByTagName("input");
            for (var y = 0; y < sliders.length; y++) {
                if (sliders[y].type === "range") {
                    sliders[y].oninput = getVals;
                    // Manually trigger event first time to display values
                    sliders[y].oninput();
                }
            }
        }
    }
    $("#reload").click(function () {
        $.get("/Filtre/test");
        $("#test").load(" #test");
    })
</script>
@{
    Layout = "~/Views/Shared/_Layout1.cshtml";
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/css/StyleSheet.css" rel="stylesheet" />

</head>
<body>
    <div style="display:inline-flex">
        <div style="border-right: 1px solid #8080807a; width: 250px; margin-top: 20px; margin-right: 20px; "></div>
            <div style="  width: 250px; margin-top: 20px; margin-right: 20px; position:fixed ">
                <p>Price Range</p>
                <section class="range-slider" style=" margin-right: 0px; width: 200px; left: 25px; height: 100px;">
                    <span class="rangeValues"></span>
                    <input value="500" min="500" max="50000" step="500" type="range" style="width: 200px;">
                    <input value="50000" min="500" max="50000" step="500" type="range" style="width: 200px;">
                </section>
                <input class="form-control" type="date" style="background-color: #ffffff;border-radius: 4px;border-color: #f1efef;margin-left: 25px;width: 205px;height: 34px;">
                <input class="form-control" type="date" style="background-color: #ffffff;border-radius: 4px;border-color: #f1efef;margin-left: 25px;width: 205px;height: 34px;">
                <select class="form-control" asp-items="Html.GetEnumSelectList<Ville>()">
                    <option selected="selected" value="">Please select</option>
                </select>
                <input type="checkbox" />offres speciales seulement
                <p id="test">@ViewBag.random</p>
                <button id="reload">reload</button>
            </div>
            <div style="display: inline-flex; flex-direction: column; margin-left: 35px; margin-top: 20px;">
                <div style=" height: 120px; box-shadow: -1px 0px 6px 1px rgb(0 0 0 / 2%), 0 6px 20px 0 rgb(0 0 0 / 10%); margin-top: 40px; background: white; border-radius: 10px; width: 1040px; align-self: center;">

                </div>
                <div style="margin-top: 30px; margin-left: 40px; margin-right: 40px; margin-bottom: 40px;">
                    <div id="bd">
                        <div style=" display: inline-flex; width: 1040px; flex-direction: row; flex-wrap: wrap; ">
                            @for (int j = 0; j < Model.Count(); j++)
                            {

                                <div class="thumb-wrapper" id="@string.Format("offre{0}", Model[j].Id)">
                                    <table style="width:220px">
                                        <tr><td style="align-content: center; background: #e03939; color: white; height: 40px; vertical-align: middle; font-size: 1.5em; font-family: century; padding-top: 10px; "><H6>Favoris<span> @*@ViewBag.NbFavorisParOffre[j]*@  <i style="color: white;" class="fas fa-heart"></i></span></H6></td></tr>
                                        <tr>
                                            <td>

                                                <table style="position: absolute; width: 220px; ">
                                                    <tr>
                                                        <td style="padding-top: 5px ;text-align:end;width:220px;">
                                                            <a style="cursor: pointer; margin-right: 5px; " onclick="FavoriChange(@Model[j].Id);">
                                                                <i class="fas fa-heart" style=" font-size:1.5em"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <table>
                                                    <tr>
                                                        <td style="padding-top: 8px;text-align: center;width:220px;">
                                                            <h6 style="font-size: 0.9rem; color: #e03939">@Model[j].Date_Dépot</h6>
                                                        </td>
                                                    </tr>
                                                </table>


                                            </td>
                                        </tr>
                                    </table>
                                    <div class="img-box">
                                        <img src="#" class="img-fluid" asp-append-version="true" alt="">

                                    </div>
                                    <div class="thumb-content">
                                        <h4>@Model[j].Titre</h4>
                                        @{double nouv = Model[j].prix - Model[j].reduction * Model[j].prix / 100;}
                                        @if (Model[j].reduction > 0)
                                        {
                                            <p class="item-price"><strike>@Model[j].prix</strike> <span>@nouv</span></p>
                                        }
                                        else
                                        {
                                            <p class="item-price"><span style="color:gray">@nouv</span></p>
                                        }
                                        <a asp-controller="Offres" asp-action="Details" asp-route-id="@Model[j].Id" style="width:150px;" class="btn btn-primary">View details</a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                </div>
            </div>
        </div>
</body>
</html>


